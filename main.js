(()=>{"use strict";var e=document.querySelector("#elementTemplate").content,t=function(t,o,n,r,c){var u=e.querySelector(".element").cloneNode(!0);u.dataset.cardId=t._id;var a=u.querySelector(".element__image");a.src=t.link,a.alt=t.name,a.addEventListener("click",n),u.querySelector(".element__title").textContent=t.name,u.querySelector(".element__likes-count").textContent=t.likes.length;var i=u.querySelector(".element__delete-button"),l=u.querySelector(".element__like-button");return l.addEventListener("click",r),t.likes.some((function(e){return e._id===o}))&&l.classList.add("element__like-button_active"),t.owner._id!==o?i.classList.add("element__delete-button_disabled"):i.addEventListener("click",c),u},o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",idSuffix:"Error"},n={popupNode:document.querySelector("#popupEditAvatar"),linkInputNode:document.querySelector("#inputAvatarLink"),formNode:document.querySelector("#popupEditAvatar").querySelector(".popup__form")},r={popupNode:document.querySelector("#popupEditProfile"),nameInputNode:document.querySelector("#inputProfileName"),nameErrorNode:document.querySelector("#inputProfileError"),employmentInputNode:document.querySelector("#inputProfileEmployment"),employmentErrorNode:document.querySelector("#inputEmploymentError"),formNode:document.querySelector("#popupEditProfile").querySelector(".popup__form")},c={popupNode:document.querySelector("#popupNewItem"),nameInputNode:document.querySelector("#inputNewItemName"),linkInputNode:document.querySelector("#inputNewItemLink"),formNode:document.querySelector("#popupNewItem").querySelector(".popup__form")},u={popupNode:document.querySelector("#popupImage"),imageNode:document.querySelector(".popup__figure-image"),captionNode:document.querySelector(".popup__figure-caption")};function a(e){e.classList.add("popup_opened"),document.addEventListener("keydown",d)}function i(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",d)}function l(e,t,o){var n=e.querySelector(".popup__submit-button");n.disabled=o,n.textContent=t}function d(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&i(t)}}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&i(e)}))}));var p=function(e,t,o){var n=e.querySelector("#".concat(t.id).concat(o.idSuffix));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""};function s(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}var m=function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,o):function(e,t,o,n){var r=e.querySelector("#".concat(t.id).concat(n.idSuffix));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)},f=function(e,t){var o=e.querySelector(t.formSelector);if(o){var n=Array.from(o.querySelectorAll(t.inputSelector));s(n,o.querySelector(t.submitButtonSelector),t),n.forEach((function(e){p(o,e,t)}))}},v={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"e1c7a508-b41b-4183-8776-1689fa2e2758","Content-Type":"application/json"}};function y(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}function _(e){return fetch("".concat(v.baseUrl,"/").concat(e),{headers:v.headers}).then((function(e){return y(e)}))}function N(e,t){return fetch("".concat(v.baseUrl,"/").concat(e),{method:"PATCH",headers:v.headers,body:JSON.stringify(t)}).then((function(e){return y(e)}))}function S(e,t){return fetch("".concat(v.baseUrl,"/").concat(e),{method:"DELETE",headers:v.headers,body:JSON.stringify(t)}).then((function(e){return y(e)}))}function h(){return _("users/me")}var q,b=document.querySelector(".elements__list"),E={data:{},nameNode:document.querySelector(".profile__name"),avatarNode:document.querySelector(".profile__avatar-container"),avatarImageNode:document.querySelector(".profile__avatar"),employmentNode:document.querySelector(".profile__employment"),editButtonNode:document.querySelector("#editProfileButton"),newItemButtonNode:document.querySelector("#addNewItemButton")};function k(e){var t=e.target.closest(".element");if(null!=t){var o=t.querySelector(".element__image"),n=o.src,r=o.alt,c=t.querySelector(".element__title").textContent;u.imageNode.src=n,u.imageNode.alt=r,u.captionNode.textContent=c}a(u.popupNode)}function g(e){var t,o=e.target.closest(".element");e.target.classList.contains("element__like-button_active")?(t=o.dataset.cardId,S("cards/likes/".concat(t),{})).then((function(t){o.querySelector(".element__likes-count").textContent=t.likes.length,L(e)})).catch((function(e){console.error("Не удалось убрать лайк. ".concat(e))})):function(e){return t="cards/likes/".concat(e),o={},fetch("".concat(v.baseUrl,"/").concat(t),{method:"PUT",headers:v.headers,body:JSON.stringify(o)}).then((function(e){return y(e)}));var t,o}(o.dataset.cardId).then((function(t){o.querySelector(".element__likes-count").textContent=t.likes.length,L(e)})).catch((function(e){console.error("Не удалось поставить лайк. ".concat(e))}))}function L(e){e.target.classList.toggle("element__like-button_active")}function C(e){var t;(t=e.target.closest(".element").dataset.cardId,S("cards/".concat(t),{})).then((function(){e.target.closest(".element").remove()})).catch((function(e){console.error("Не удалось удалить карточку. ".concat(e))}))}h().then((function(){h().then((function(e){E.data=e,E.nameNode.textContent=e.name,E.employmentNode.textContent=e.about,E.avatarImageNode.src=e.avatar}))})).then((function(){_("cards").then((function(e){e.forEach((function(e){var o=t(e,E.data._id,k,g,C);b.append(o)}))})).catch((function(e){console.error("Не удалось загрузить карточки. ".concat(e))}))})).catch((function(e){console.error("Не удалось загрузить профиль. ".concat(e))})),E.editButtonNode.addEventListener("click",(function(){r.nameInputNode.value=E.nameNode.textContent,r.employmentInputNode.value=E.employmentNode.textContent,a(r.popupNode),f(r.popupNode,o)})),E.newItemButtonNode.addEventListener("click",(function(){c.formNode.reset(),a(c.popupNode),f(c.popupNode,o)})),r.formNode.addEventListener("submit",(function(e){var t,o;e.preventDefault(),l(r.popupNode,"Сохранение...",!0),(t=r.nameInputNode.value,o=r.employmentInputNode.value,N("users/me",{name:t,about:o})).then((function(e){E.nameNode.textContent=e.name,E.employmentNode.textContent=e.about,i(r.popupNode)})).catch((function(e){console.error("Не удалось отредактировать профиль. ".concat(e))})).finally((function(){l(r.popupNode,"Сохранить",!1)}))})),c.formNode.addEventListener("submit",(function(e){e.preventDefault();var o={name:c.nameInputNode.value,link:c.linkInputNode.value};l(c.popupNode,"Создание...",!0),function(e){return t={name:e.name,link:e.link},fetch("".concat(v.baseUrl,"/").concat("cards"),{method:"POST",headers:v.headers,body:JSON.stringify(t)}).then((function(e){return y(e)}));var t}(o).then((function(e){var o=t(e,E.data._id,k,g,C);b.prepend(o),i(c.popupNode)})).catch((function(e){console.error("Не удалось добавить карточку. ".concat(e))})).finally((function(){l(c.popupNode,"Создать",!1)}))})),n.formNode.addEventListener("submit",(function(e){var t;e.preventDefault(),l(n.popupNode,"Сохранение...",!0),(t=n.linkInputNode.value,N("users/me/avatar",{avatar:t})).then((function(e){E.avatarImageNode.src=e.avatar,n.linkInputNode.value="",i(n.popupNode)})).catch((function(e){console.error("Не удалось обновить аватар. ".concat(e))})).finally((function(){l(n.popupNode,"Сохранить",!1)}))})),E.avatarNode.addEventListener("click",(function(){a(n.popupNode),f(n.popupNode,o)})),q=o,Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);s(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){m(e,r,t),s(o,n,t)}))}))}(e,q)}))})();