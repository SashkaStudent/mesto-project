(()=>{"use strict";var e=document.querySelector("#elementTemplate").content,t=function(t,o){var n=e.querySelector(".element").cloneNode(!0);n.dataset.cardId=t._id;var r=n.querySelector(".element__image");r.src=t.link,r.alt=t.name,n.querySelector(".element__title").textContent=t.name,n.querySelector(".element__likes-count").textContent=t.likes.length;var a=n.querySelector(".element__delete-button");return o&&a.classList.add("element__delete-button_disabled"),n},o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",idSuffix:"Error"},n={popupNode:document.querySelector("#popupEditAvatar"),linkInputNode:document.querySelector("#inputAvatarLink"),formNode:document.querySelector("#popupEditAvatar").querySelector(".popup__form")},r={popupNode:document.querySelector("#popupEditProfile"),nameInputNode:document.querySelector("#inputProfileName"),nameErrorNode:document.querySelector("#inputProfileError"),employmentInputNode:document.querySelector("#inputProfileEmployment"),employmentErrorNode:document.querySelector("#inputEmploymentError"),formNode:document.querySelector("#popupEditProfile").querySelector(".popup__form")},a={popupNode:document.querySelector("#popupNewItem"),nameInputNode:document.querySelector("#inputNewItemName"),linkInputNode:document.querySelector("#inputNewItemLink"),formNode:document.querySelector("#popupNewItem").querySelector(".popup__form")},u={popupNode:document.querySelector("#popupImage"),imageNode:document.querySelector(".popup__figure-image"),captionNode:document.querySelector(".popup__figure-caption")};function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",d)}function i(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",d)}function l(e,t,o){var n=e.querySelector(".popup__submit-button");n.disabled=o,n.textContent=t}function d(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&i(t)}}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&i(e)}))}));var p=function(e,t,o){var n=e.querySelector("#".concat(t.id).concat(o.idSuffix));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""};function s(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}var m=function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,o):function(e,t,o,n){var r=e.querySelector("#".concat(t.id).concat(n.idSuffix));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)},f=function(e,t){var o=e.querySelector(t.formSelector);if(o){var n=Array.from(o.querySelectorAll(t.inputSelector));s(n,o.querySelector(t.submitButtonSelector),t),n.forEach((function(e){p(o,e,t)}))}},_={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"e1c7a508-b41b-4183-8776-1689fa2e2758","Content-Type":"application/json"}};function y(e){return fetch("".concat(_.baseUrl,"/").concat(e),{headers:_.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}function v(e,t){return fetch("".concat(_.baseUrl,"/").concat(e),{method:"PATCH",headers:_.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}function N(e,t){return fetch("".concat(_.baseUrl,"/").concat(e),{method:"DELETE",headers:_.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}var S,q=document.querySelector(".elements__list"),h={data:{},nameNode:document.querySelector(".profile__name"),avatarNode:document.querySelector(".profile__avatar-container"),avatarImageNode:document.querySelector(".profile__avatar"),employmentNode:document.querySelector(".profile__employment"),editButtonNode:document.querySelector("#editProfileButton"),newItemButtonNode:document.querySelector("#addNewItemButton")};y("users/me").then((function(e){h.data=e,h.nameNode.textContent=e.name,h.employmentNode.textContent=e.about,console.log(e),console.log(h),h.avatarImageNode.src=e.avatar})),y("cards").then((function(e){console.log(e),e.forEach((function(e){var o=e.owner._id!==h.data._id,n=t(e,o);e.likes.some((function(e){return e._id===h.data._id}))&&n.querySelector(".element__like-button").classList.add("element__like-button_active"),q.append(n)}))})),h.editButtonNode.addEventListener("click",(function(){r.nameInputNode.value=h.nameNode.textContent,r.employmentInputNode.value=h.employmentNode.textContent,c(r.popupNode),f(r.popupNode,o)})),h.newItemButtonNode.addEventListener("click",(function(){a.formNode.reset(),c(a.popupNode),f(a.popupNode,o)})),r.formNode.addEventListener("submit",(function(e){var t,o;e.preventDefault(),l(r.popupNode,"Сохранение...",!0),(t=r.nameInputNode.value,o=r.employmentInputNode.value,v("users/me",{name:t,about:o})).then((function(e){h.nameNode.textContent=e.name,h.employmentNode.textContent=e.about})).finally((function(){l(r.popupNode,"Сохранить",!1),i(r.popupNode)}))})),a.formNode.addEventListener("submit",(function(e){e.preventDefault();var o={name:a.nameInputNode.value,link:a.linkInputNode.value};l(a.popupNode,"Создание...",!0),function(e){return t={name:e.name,link:e.link},fetch("".concat(_.baseUrl,"/").concat("cards"),{method:"POST",headers:_.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}));var t}(o).then((function(e){var o=t(e,!1);q.prepend(o)})).finally((function(){l(a.popupNode,"Создать",!1),i(a.popupNode)}))})),n.formNode.addEventListener("submit",(function(e){var t;e.preventDefault(),l(n.popupNode,"Сохранение...",!0),(t=n.linkInputNode.value,v("users/me/avatar",{avatar:t})).then((function(e){h.avatarImageNode.src=e.avatar})).finally((function(){l(n.popupNode,"Сохранить",!1),n.linkInputNode.value="",i(n.popupNode)}))})),h.avatarNode.addEventListener("click",(function(){c(n.popupNode),f(n.popupNode,o)})),q.addEventListener("click",(function(e){var t,o,n=e.target.classList;if(n.contains("element__image"))!function(e){var t=e.target.closest(".element");if(null!=t){var o=t.querySelector(".element__image"),n=o.src,r=o.alt,a=t.querySelector(".element__title").textContent;u.imageNode.src=n,u.imageNode.alt=r,u.captionNode.textContent=a}c(u.popupNode)}(e);else if(n.contains("element__like-button")){var r=e.target.closest(".element");e.target.classList.contains("element__like-button_active")?(t=r.dataset.cardId,N("cards/likes/".concat(t),{})).then((function(e){r.querySelector(".element__likes-count").textContent=e.likes.length})):function(e){return t="cards/likes/".concat(e),o={},fetch("".concat(_.baseUrl,"/").concat(t),{method:"PUT",headers:_.headers,body:JSON.stringify(o)}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}));var t,o}(r.dataset.cardId).then((function(e){r.querySelector(".element__likes-count").textContent=e.likes.length})),e.target.classList.toggle("element__like-button_active")}else n.contains("element__delete-button")&&!n.contains("element__delete-button_disabled")&&function(e){return N("cards/".concat(e),{})}((o=e).target.closest(".element").dataset.cardId).then((function(){o.target.closest(".element").remove()}))})),S=o,Array.from(document.querySelectorAll(S.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);s(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){m(e,r,t),s(o,n,t)}))}))}(e,S)}))})();